(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["users/editLabel"],{"29a5":function(e,t,o){"use strict";o("c6ce")},"3c0d":function(e,t,o){"use strict";o.r(t);var s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-form",{ref:"form",staticClass:"le-matter",attrs:{"label-width":"170px",model:e.form,rules:e.rules},nativeOn:{submit:function(e){e.preventDefault()}}},[o("el-breadcrumb",{staticClass:"he-link-text",attrs:{"separator-class":"el-icon-arrow-right"}},[o("el-breadcrumb-item",{staticClass:"he-link"},[o("he-link",{attrs:{href:"users/userLabel"}},[e._v("用户标签")])],1),o("el-breadcrumb-item",[e._v(" "+e._s(e.$route.query.id?"编辑标签":"新建标签")+" ")])],1),o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"le-card"},[o("el-form-item",[o("span",{staticClass:"le-form-item__label",attrs:{slot:"label"},slot:"label"},[e._v("标签类型")]),o("el-radio-group",{attrs:{disabled:!!e.$route.query.id},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[o("el-radio",{attrs:{label:1}},[e._v("手动标签")]),o("el-radio",{attrs:{label:2}},[e._v("自动标签")])],1)],1),o("el-form-item",{attrs:{prop:"name"}},[o("span",{staticClass:"le-form-item__label",attrs:{slot:"label"},slot:"label"},[e._v("标签名称")]),o("el-input",{attrs:{maxlength:"8","show-word-limit":""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),2===e.form.type?[o("el-form-item",[o("span",{staticClass:"le-form-item__label",attrs:{slot:"label"},slot:"label"},[e._v("标签类型")]),o("div",{staticClass:"le-form-item-type"},[o("div",{staticClass:"le-form-item__line"},[o("el-radio-group",{model:{value:e.form.conditions_status,callback:function(t){e.$set(e.form,"conditions_status",t)},expression:"form.conditions_status"}},[o("el-radio",{attrs:{label:1}},[e._v("满足所有条件")]),o("el-radio",{attrs:{label:2}},[e._v("满足任一条件")])],1),1===e.form.conditions_status?o("div",{staticClass:"le-form-item-tip"},[e._v(" 所有条件互相独立，即:"),o("br"),e._v(" 1.订单无需满足在某个时间段内累计消费X次，累计消费X金额；"),o("br"),e._v(" 2.订单需既购买过指定商品，也购买过指定分类，而非购买指定分类下的指定商品。 ")]):e._e()],1),o("div",{staticClass:"le-form-item__line le-form-checkbox"},[o("el-checkbox",{model:{value:e.form.conditions_setting.shopping_time.checked,callback:function(t){e.$set(e.form.conditions_setting.shopping_time,"checked",t)},expression:"form.conditions_setting.shopping_time.checked"}},[e._v(" 消费时间 ")]),o("el-date-picker",{attrs:{disabled:!e.form.conditions_setting.shopping_time.checked,type:"datetime","value-format":"timestamp",placeholder:"开始日期"},model:{value:e.form.conditions_setting.shopping_time.value.start,callback:function(t){e.$set(e.form.conditions_setting.shopping_time.value,"start",t)},expression:"form.conditions_setting.shopping_time.value.start"}}),o("span",{staticClass:"le-form-date-go"},[e._v("至")]),o("el-date-picker",{attrs:{disabled:!e.form.conditions_setting.shopping_time.checked,type:"datetime","value-format":"timestamp",placeholder:"结束日期"},model:{value:e.form.conditions_setting.shopping_time.value.end,callback:function(t){e.$set(e.form.conditions_setting.shopping_time.value,"end",t)},expression:"form.conditions_setting.shopping_time.value.end"}})],1),o("div",{staticClass:"le-form-item__line le-form-checkbox"},[o("el-checkbox",{model:{value:e.form.conditions_setting.shopping_number.checked,callback:function(t){e.$set(e.form.conditions_setting.shopping_number,"checked",t)},expression:"form.conditions_setting.shopping_number.checked"}},[e._v(" 历史累计消费次数 ")]),o("el-input",{attrs:{change:e.checkNumber(),disabled:!e.form.conditions_setting.shopping_number.checked},model:{value:e.form.conditions_setting.shopping_number.value,callback:function(t){e.$set(e.form.conditions_setting.shopping_number,"value",t)},expression:"form.conditions_setting.shopping_number.value"}},[o("template",{slot:"append"},[e._v("次")])],2)],1),o("div",{staticClass:"le-form-item__line le-form-checkbox"},[o("el-checkbox",{model:{value:e.form.conditions_setting.shopping_amount.checked,callback:function(t){e.$set(e.form.conditions_setting.shopping_amount,"checked",t)},expression:"form.conditions_setting.shopping_amount.checked"}},[e._v(" 历史累计消费金额 ")]),o("el-input",{attrs:{change:e.checkAmount(),disabled:!e.form.conditions_setting.shopping_amount.checked},model:{value:e.form.conditions_setting.shopping_amount.value,callback:function(t){e.$set(e.form.conditions_setting.shopping_amount,"value",t)},expression:"form.conditions_setting.shopping_amount.value"}},[o("template",{slot:"append"},[e._v("元")])],2)],1),o("div",{staticClass:"le-form-item__line le-form-checkbox"},[o("el-checkbox",{model:{value:e.form.conditions_setting.shopping_goods.checked,callback:function(t){e.$set(e.form.conditions_setting.shopping_goods,"checked",t)},expression:"form.conditions_setting.shopping_goods.checked"}},[e._v(" 购买指定商品 ")]),o("button",{staticClass:"le-form-button",attrs:{disabled:!e.form.conditions_setting.shopping_goods.checked},on:{click:e.getGoods}},[e._v(" 选择商品 ")]),o("goods-select",{ref:"goodsSelect",attrs:{"is-tips":!1,"select-style":{backgroundColor:"#ffffff"}},model:{value:e.form.conditions_setting.shopping_goods.value,callback:function(t){e.$set(e.form.conditions_setting.shopping_goods,"value",t)},expression:"form.conditions_setting.shopping_goods.value"}}),e.form.conditions_setting.shopping_goods.checked&&e.form.conditions_setting.shopping_goods.value.length?o("el-table",{staticClass:"le-goods-table",attrs:{"max-height":"368px","row-class-name":"le-table-row",data:e.form.conditions_setting.shopping_goods.value}},[o("el-table-column",{attrs:{label:"商品"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"le-table-goods flex align-center"},[o("img",{attrs:{src:t.row.slideshow[0],alt:""}}),o("div",{staticClass:"he-line-2"},[e._v(e._s(t.row.name))])])]}}],null,!1,1926221857)}),o("el-table-column",{attrs:{label:"商品价格",prop:"price",width:"160"}}),o("el-table-column",{attrs:{label:"库存",prop:"stocks",width:"160"}}),o("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"le-button-text",on:{click:function(o){return e.form.conditions_setting.shopping_goods.value.splice(t.$index,1)}}},[e._v("删除")])]}}],null,!1,1022582724)})],1):e._e()],1),o("div",{staticClass:"le-form-item__line le-form-checkbox"},[o("el-checkbox",{model:{value:e.form.conditions_setting.shopping_group.checked,callback:function(t){e.$set(e.form.conditions_setting.shopping_group,"checked",t)},expression:"form.conditions_setting.shopping_group.checked"}},[e._v(" 购买指定分类 ")]),o("button",{directives:[{name:"popup",rawName:"v-popup.chooseCategory",value:e.catObject,expression:"catObject",modifiers:{chooseCategory:!0}}],staticClass:"le-form-button",attrs:{action:"openGroup",title:"选择分类",width:"801",module:"goods",disabled:!e.form.conditions_setting.shopping_group.checked}},[e._v(" 指定分类 ")]),o("div",{staticClass:"le-form-group"},e._l(e.catObject.result,(function(t,s){return o("span",{key:s,staticClass:"le-group-item"},[e._v(e._s(t.value)+" "),o("he-icon",{staticClass:"le-group-item-delete",attrs:{size:"10px",type:"le-icon-fork"},nativeOn:{click:function(o){return e.deleteTag(t,s)}}})],1)})),0)],1)])]),o("el-form-item",[o("span",{staticClass:"le-form-item__label",attrs:{slot:"label"},slot:"label"},[e._v("用户剔除")]),o("button",{directives:[{name:"popup",rawName:"v-popup.chooseUser",value:{item:e.form.filter_user},expression:"{ item: form.filter_user }",modifiers:{chooseUser:!0}}],staticClass:"le-form-button",attrs:{width:"577",title:"选择用户",module:"users",action:"chooseUser"}},[e._v(" 选择用户 ")]),o("div",{staticClass:"le-form-item-tip"},[e._v(" 已被打上标签的用户，被剔除掉，则不再属于该标签用户，此后也将不自动打上此标签；"),o("br"),e._v(" 未被打上标签的用户，被剔除掉，则当条件满足时，也不会被自动打上此标签； ")]),e.form.filter_user.length?o("el-table",{staticClass:"le-users-table",attrs:{data:e.form.filter_user,"max-height":"368px","row-class-name":"le-table-row"}},[o("el-table-column",{attrs:{label:"用户ID",width:"120",prop:"id"}}),o("el-table-column",{attrs:{label:"用户昵称",prop:"nickname"}}),o("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"le-button-text",on:{click:function(o){return e.form.filter_user.splice(t.$index,1)}}},[e._v("移除")])]}}],null,!1,4097585928)})],1):e._e()],1),o("el-form-item",[o("span",{staticClass:"le-form-item__label",attrs:{slot:"label"},slot:"label"},[e._v("是否启用")]),o("el-radio-group",{model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[o("el-radio",{attrs:{label:1}},[e._v("启用")]),o("el-radio",{attrs:{label:0}},[e._v("禁用")])],1)],1)]:e._e()],2),o("div",{staticClass:"le-cardpin"},[o("el-button",{attrs:{disabled:e.loading},on:{click:e.cancel}},[e._v("取消")]),o("el-button",{attrs:{type:"primary",disabled:e.loading},on:{click:e.submit}},[e._v("保存")])],1)],1)},i=[],n=o("1da1"),a=(o("96cf"),o("d81d"),o("159b"),o("b0c0"),o("99af"),o("a434"),o("ac1f"),o("1276"),o("a9e3"),o("5319"),o("57f9")),r={name:"editLabel",components:{goodsSelect:a["a"]},data:function(){return{rules:{name:[{required:!0,message:"请输入标签名称",trigger:"blur"}]},form:{type:1,name:"",status:1,conditions_status:1,conditions_setting:{shopping_time:{checked:!1,value:{start:"",end:""}},shopping_group:{checked:!1,value:[]},shopping_goods:{checked:!1,value:[]},shopping_amount:{checked:!1,value:""},shopping_number:{checked:!1,value:""}},filter_user:[]},catObject:{cat:[],result:[]},loading:!0,catTree:[]}},methods:{getGoods:function(){this.$refs.goodsSelect.open()},openGroup:function(e){for(var t=[],o=0;o<e.result.length;o++){var s=e.result[o];s.children||t.push(s)}this.catObject.result=t,this.form.conditions_setting.shopping_group.value=this.catObject.result.map((function(e){return e.id}))},getGroupList:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$heshop.group("get",{include:"goods"});case 2:e.catObject.cat=t.sent,o=e.$heshop.toTree({parentKey:"parent_id",idKey:"id",parentId:0,childrenKey:"children"}).on(e.catObject.cat).get(),o.forEach((function(e){e.value=e.name,e.children&&e.children.forEach((function(t){t.value="".concat(e.value," > ").concat(t.name),t.children&&t.children.forEach((function(e){e.value="".concat(t.value," > ").concat(e.name)}))}))})),e.catTree=o;case 6:case"end":return t.stop()}}),t)})))()},chooseUser:function(e){this.form.filter_user=e.item},deleteTag:function(e,t){var o=this;this.catObject.result.splice(t,1);var s=e.path.split("-").map(Number),i=s.length;if(3===i){var n=!1,a=!1;this.catObject.result.forEach((function(e,t){e.id===s[1]&&(a||(a=!0,o.catObject.result.splice(t,1)),o.catObject.result.forEach((function(e,t){e.id===s[2]&&(n||(n=!0,o.catObject.result.splice(t,1)))})))}))}else if(2===i){var r=!1;this.catObject.result.forEach((function(e,t){e.id===s[1]&&(r||(r=!0,o.catObject.result.splice(t,1)))}))}this.form.conditions_setting.shopping_group.value=this.catObject.result.map((function(e){return e.id}))},submit:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return!1;if(e.loading=!0,1===e.form.type)e.form.conditions_setting=null,e.$delete(e.form,"filter_user"),e.$delete(e.form,"conditions_status"),e.$delete(e.form,"status");else{var o=e.form.conditions_setting,s=o.shopping_time,i=o.shopping_group,n=o.shopping_goods,a=o.shopping_amount,r=o.shopping_number;if(!s.checked&&!a.checked&&!r.checked&&!n.checked&&!i.checked)return e.loading=!1,void e.$message.error("请至少设置一个打标条件");if(s.checked){var l=s.value,c=l.start,u=l.end;if(!c&&!u)return e.loading=!1,void e.$message.error("消费时间不能为空");if(!c&&u)return e.loading=!1,void e.$message.error("消费开始时间不能为空");if(c&&!u)return e.loading=!1,void e.$message.error("消费结束时间不能为空");if(c>=u)return e.loading=!1,void e.$message.error("消费时间开始时间必须小于结束时间")}if(r.checked&&!r.value)return e.loading=!1,void e.$message.error("消费次数不能为空");if(a.checked&&!a.value)return e.loading=!1,void e.$message.error("消费金额不能为空");if(n.checked&&0===n.value.length)return e.loading=!1,void e.$message.error("购买指定商品不能为空");if(i.checked&&0===i.value.length)return e.loading=!1,void e.$message.error("购买指定分类不能为空");if(s.checked){var d=s.value,p=d.start,m=d.end;p+="",s.value.start=parseInt(p.substring(0,p.length-3)),m+="",s.value.end=parseInt(m.substring(0,m.length-3)),e.form.conditions_setting.shopping_group.value=e.catObject.result}}e.$route.query.id?e.$heshop.userlabel("put",{id:e.$route.query.id},e.form).then((function(){e.cancel()})).catch((function(t){e.loading=!1,403===t.status&&e.$message.error(t.data.message)})):e.$heshop.userlabel("post",e.form).then((function(){e.cancel()})).catch((function(t){e.loading=!1,403===t.status&&e.$message.error(t.data.message)}))}))},cancel:function(){this.$router.replace({path:"/users/userLabel",query:{type:this.form.type}})},getDetail:function(e){var t=this;this.$heshop.userlabel("get",e).then((function(e){if(t.form=e,1!==e.type){var o=t.form.conditions_setting.shopping_group.value,s=t.form.conditions_setting.shopping_time;if(s.checked){var i=s.value,n=i.start,a=i.end;n+="000",a+="000",s.value.start=parseInt(n),s.value.end=parseInt(a)}var r=[];o.forEach((function(e){t.catTree.forEach((function(t){t.id==e.id&&r.push(t),t.children&&t.children.forEach((function(t){t.id==e.id&&r.push(t),t.children&&t.children.forEach((function(t){t.id==e.id&&r.push(t)}))}))}))})),t.catObject.result=r}}))},checkAmount:function(){var e=""+this.form.conditions_setting.shopping_amount.value;e=e.replace(/[^\d.]/g,"").replace(/\.{2,}/g,".").replace(/^\./g,"").replace(".","$#$").replace(/\./g,"").replace("$#$",".").replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3"),e.indexOf(".")<0&&""!=e&&(e=parseFloat(e)),this.form.conditions_setting.shopping_amount.value=e},checkNumber:function(){var e=""+this.form.conditions_setting.shopping_number.value;e=e.replace(/[^\d]/g,""),e.indexOf(".")<0&&""!=e&&(e=parseFloat(e)),this.form.conditions_setting.shopping_number.value=e}},mounted:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getGroupList();case 2:return e.loading=!1,o=e.$route.query.id,s=e.$route.query.type,t.next=7,o;case 7:if(!t.sent){t.next=11;break}e.getDetail(parseInt(o)),t.next=12;break;case 11:e.form.type=parseInt(s);case 12:case"end":return t.stop()}}),t)})))()}},l=r,c=(o("29a5"),o("2877")),u=Object(c["a"])(l,s,i,!1,null,"3be0b172",null);t["default"]=u.exports},c6ce:function(e,t,o){}}]);